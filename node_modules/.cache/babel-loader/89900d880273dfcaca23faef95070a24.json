{"ast":null,"code":"var _jsxFileName = \"/home/brandonzpb/Documents/projects/custom/creatures-of-habit/creatures-frontend/src/contexts/CreatureContext.js\";\nimport React, { useState, useReducer, useEffect, useContext, createContext } from 'react';\nimport creatureReducer from '../reducers/creatureReducer';\nimport * as objective from '../modules/objective';\nimport * as streakTime from '../modules/age';\nimport creatureService from '../services/creatureService';\nimport { UserContext } from './UserContext';\nexport const CreatureContext = createContext();\n\nconst CreatureContextProvider = props => {\n  const {\n    user,\n    userDispatch,\n    updateUser\n  } = useContext(UserContext);\n  const [creatures, dispatch] = useReducer(creatureReducer, user.creatures); //   const creatures = localStorage.getItem('my-user');\n  //   const storedCreatures = creatures ? JSON.parse(creatures) : [];\n  //   return storedCreatures.creatures;\n  // });\n\n  /* useEffect(() => {\n    console.log('creatures', creatures)\n     dispatch({ type: 'UPDATE_STATE', creatures: { creatures: user.creatures }});\n  }, [])\n   useEffect(() => {\n    userDispatch({ type: 'UPDATE_CREATURES', creatures: { creatures: user.creatures }});\n    localStorage.setItem('my-user', JSON.stringify(user));\n  }, [user.creatures]); */\n\n  /* const [creatures, dispatch] = useReducer(creatureReducer, [], () => {\n    const storedCreatures = localStorage.getItem('my-creatures');\n    return storedCreatures ? JSON.parse(storedCreatures) : [];\n  });\n   useEffect(() => {\n    localStorage.setItem('my-creatures', JSON.stringify(creatures));\n  }, [creatures]); */\n\n  const [currentId, setCurrentId] = useState('');\n  const [play, setPlay] = useState(false);\n  const [formDisplay, setFormDisplay] = useState(true);\n  const [expUpdate, setExpUpdate] = useState(false);\n  const [done, setDone] = useState({\n    type: '',\n    object: '',\n    method: ''\n  });\n  useEffect(() => {\n    if (done.type.trim()) {\n      if (done.type === 'objective') {\n        updateObjectives();\n      } else if (done.type === 'creature') {\n        if (done.method === 'create') createCreature(done.object);else if (done.method === 'stats') updateCreatureStats(done.object.id);else if (done.method === 'info') updateCreatureInfo(done.object.id);\n      } else if (done.type === 'db') {\n        updateUser();\n      }\n\n      return setDone({ ...done,\n        type: '',\n        object: null,\n        method: ''\n      });\n    }\n\n    return false;\n  }, [done]); // CREATE CREATURE\n\n  const finish = (type, object = null, method = null) => {\n    return type = 'creature' ? setDone({ ...done,\n      type,\n      object,\n      method\n    }) : setDone({ ...done,\n      type,\n      object,\n      method\n    });\n  };\n\n  const createCreature = creatureObject => {\n    creatureService.createCreature(user.db_id, creatureObject, user.accessToken).then(res => {\n      console.log(res);\n      finish('db');\n      return res;\n    }).catch(err => console.error(err));\n    console.log('Successfully added creature', creatureObject);\n  }; // UPDATE CREATURE STATS\n\n\n  const updateCreatureStats = async creatureId => {\n    console.log('Updating creature...');\n    const creature = user.creatures.filter(being => being.id === creatureId);\n    await creatureService.updateCreatureStats(user.db_id, creature[0]._id, creature[0], user.accessToken).then(res => res).catch(err => console.error(err));\n    console.log('Successfully updated creature');\n  }; // UPDATE CREATURE INFO\n\n\n  const updateCreatureInfo = async creatureId => {\n    console.log('Updating creature...');\n    const creature = user.creatures.filter(being => being.id === creatureId);\n    await creatureService.updateCreatureInfo(user.db_id, creature[0]._id, creature[0], user.accessToken).then(res => res).catch(err => console.error(err));\n    console.log('Successfully updated creature');\n  }; /// OBJECTIVE METHODS ///\n\n\n  const checkObjectiveText = (creatureId, text) => {\n    const thisCreature = user.creatures.filter(being => being.id === creatureId);\n    const objectiveIndex = thisCreature[0].objectives.findIndex(item => item.text.toLowerCase() === text.toLowerCase());\n    return objectiveIndex >= 0 ? true : false;\n  }; // UPDATE OBJECTIVES\n\n\n  const updateObjectives = async () => {\n    const creature = user.creatures.filter(creature => creature.id === currentId);\n    const objectives = creature[0].objectives;\n    console.log('objectives', objectives);\n    await creatureService.updateObjectives(user.db_id, creature[0]._id, objectives, user.accessToken).then(res => console.log('res', res)).catch(err => console.error(err));\n    console.log('Successfully updated objectives');\n  }; // DELETE CREATURE\n\n\n  const deleteCreature = async creatureId => {\n    const creature = user.creatures.filter(being => being.id === creatureId);\n    userDispatch({\n      type: 'DELETE_CREATURE',\n      id: creatureId\n    });\n    await creatureService.deleteCreature(user.db_id, creature[0]._id, user.accessToken).then(res => res).catch(err => console.error(err));\n    console.log('Successfully deleted creature: ' + creature);\n  };\n\n  const getExp = (habit, time) => {\n    const creature = user.creatures.filter(creature => creature.id === currentId);\n    if (creature[0].is_noob) return getFirstExp(creature[0]);\n    const streakCount = creature[0].streak_count;\n    const newExp = objective.calcExp(creature[0].multiplier, streakCount, habit.difficulty, time);\n    const newTotal = creature[0].exp + newExp;\n    const newSurplus = newTotal >= creature[0].exp_goal ? newTotal - creature[0].exp_goal : creature[0].exp_surplus + newExp;\n    userDispatch({\n      type: 'ADD_EXP',\n      creature: {\n        id: currentId,\n        newTotal,\n        newSurplus\n      }\n    });\n    return creature;\n  };\n\n  const getFirstExp = creature => {\n    const newTotal = 1;\n    const newSurplus = 0;\n    userDispatch({\n      type: 'ADD_EXP',\n      creature: {\n        id: creature.id,\n        newTotal,\n        newSurplus\n      }\n    });\n    return creature;\n  };\n\n  const toggleExpUpdate = () => {\n    setExpUpdate(!expUpdate);\n  };\n\n  const toggleFormDisplay = () => {\n    setFormDisplay(!formDisplay);\n  };\n\n  const showCreatureObjectives = async id => {\n    return setCurrentId(id);\n  };\n\n  const togglePlay = () => {\n    setPlay(!play);\n  };\n\n  return /*#__PURE__*/React.createElement(CreatureContext.Provider, {\n    value: {\n      creatures,\n      createCreature,\n      updateCreatureInfo,\n      updateCreatureStats,\n      updateObjectives,\n      deleteCreature,\n      currentId,\n      play,\n      togglePlay,\n      formDisplay,\n      toggleFormDisplay,\n      expUpdate,\n      toggleExpUpdate,\n      done,\n      setDone,\n      finish,\n      dispatch,\n      showCreatureObjectives,\n      getExp,\n      checkObjectiveText\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 5\n    }\n  }, props.children);\n};\n\nexport default CreatureContextProvider;","map":{"version":3,"sources":["/home/brandonzpb/Documents/projects/custom/creatures-of-habit/creatures-frontend/src/contexts/CreatureContext.js"],"names":["React","useState","useReducer","useEffect","useContext","createContext","creatureReducer","objective","streakTime","creatureService","UserContext","CreatureContext","CreatureContextProvider","props","user","userDispatch","updateUser","creatures","dispatch","currentId","setCurrentId","play","setPlay","formDisplay","setFormDisplay","expUpdate","setExpUpdate","done","setDone","type","object","method","trim","updateObjectives","createCreature","updateCreatureStats","id","updateCreatureInfo","finish","creatureObject","db_id","accessToken","then","res","console","log","catch","err","error","creatureId","creature","filter","being","_id","checkObjectiveText","text","thisCreature","objectiveIndex","objectives","findIndex","item","toLowerCase","deleteCreature","getExp","habit","time","is_noob","getFirstExp","streakCount","streak_count","newExp","calcExp","multiplier","difficulty","newTotal","exp","newSurplus","exp_goal","exp_surplus","toggleExpUpdate","toggleFormDisplay","showCreatureObjectives","togglePlay","children"],"mappings":"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","sourcesContent":["import React, { useState, useReducer, useEffect, useContext, createContext } from 'react';\nimport creatureReducer from '../reducers/creatureReducer';\nimport * as objective from '../modules/objective'\nimport * as streakTime from '../modules/age';\nimport creatureService from '../services/creatureService';\nimport { UserContext } from './UserContext';\n\nexport const CreatureContext = createContext();\n\nconst CreatureContextProvider = (props) => {\n  const { user, userDispatch, updateUser } = useContext(UserContext);\n\n  const [creatures, dispatch] = useReducer(creatureReducer, user.creatures);\n  //   const creatures = localStorage.getItem('my-user');\n  //   const storedCreatures = creatures ? JSON.parse(creatures) : [];\n  //   return storedCreatures.creatures;\n  // });\n\n  /* useEffect(() => {\n    console.log('creatures', creatures)\n\n    dispatch({ type: 'UPDATE_STATE', creatures: { creatures: user.creatures }});\n  }, [])\n\n  useEffect(() => {\n    userDispatch({ type: 'UPDATE_CREATURES', creatures: { creatures: user.creatures }});\n    localStorage.setItem('my-user', JSON.stringify(user));\n  }, [user.creatures]); */\n\n  /* const [creatures, dispatch] = useReducer(creatureReducer, [], () => {\n    const storedCreatures = localStorage.getItem('my-creatures');\n    return storedCreatures ? JSON.parse(storedCreatures) : [];\n  });\n\n  useEffect(() => {\n    localStorage.setItem('my-creatures', JSON.stringify(creatures));\n  }, [creatures]); */\n\n  const [currentId, setCurrentId] = useState('');\n  const [play, setPlay] = useState(false);\n  const [formDisplay, setFormDisplay] = useState(true);\n  const [expUpdate, setExpUpdate] = useState(false);\n\n  const [done, setDone] = useState({\n    type: '',\n    object: '',\n    method: '',\n  });\n\n  useEffect(() => {\n    if (done.type.trim()) {\n\n      if (done.type === 'objective') {\n        updateObjectives();\n\n      } else if (done.type === 'creature') {\n        if (done.method === 'create') createCreature(done.object);\n        else if (done.method === 'stats') updateCreatureStats(done.object.id);\n        else if (done.method === 'info') updateCreatureInfo(done.object.id);\n\n      } else if (done.type === 'db') {\n        updateUser();\n      }\n\n      return setDone({ ...done,\n        type: '',\n        object: null,\n        method: '',\n      });\n    }\n\n    return false;\n  }, [done]);\n\n  // CREATE CREATURE\n  const finish = (type, object = null, method = null) => {\n    return type = 'creature' ?\n      setDone({\n        ...done, \n        type,\n        object,\n        method\n      }) :\n      setDone({\n        ...done,\n        type,\n        object,\n        method\n      });\n  }\n\n  const createCreature = creatureObject => {\n    creatureService.createCreature(user.db_id, creatureObject, user.accessToken)\n      .then(res => {\n        console.log(res);\n        finish('db');\n        return res;\n      })\n      .catch(err => console.error(err));\n\n    console.log('Successfully added creature', creatureObject);\n  }\n\n  // UPDATE CREATURE STATS\n  const updateCreatureStats = async (creatureId) => {\n    console.log('Updating creature...');\n\n    const creature = user.creatures.filter(being => being.id === creatureId);\n\n    await creatureService.updateCreatureStats(user.db_id, creature[0]._id, creature[0], user.accessToken)\n      .then(res => res)\n      .catch(err => console.error(err));\n\n    console.log('Successfully updated creature');\n  }\n\n  // UPDATE CREATURE INFO\n  const updateCreatureInfo = async (creatureId) => {\n    console.log('Updating creature...');\n\n    const creature = user.creatures.filter(being => being.id === creatureId);\n\n    await creatureService.updateCreatureInfo(user.db_id, creature[0]._id, creature[0], user.accessToken)\n      .then(res => res)\n      .catch(err => console.error(err));\n\n    console.log('Successfully updated creature');\n  }\n\n  /// OBJECTIVE METHODS ///\n\n  const checkObjectiveText = (creatureId, text) => {\n    const thisCreature = user.creatures.filter(being => being.id === creatureId);\n\n    const objectiveIndex = thisCreature[0].objectives.findIndex(item => item.text.toLowerCase() === text.toLowerCase());\n    return (objectiveIndex >= 0) ? true : false;\n  }\n\n  // UPDATE OBJECTIVES\n  const updateObjectives = async () => {\n    const creature = user.creatures.filter(creature => creature.id === currentId);\n\n    const objectives = creature[0].objectives;\n    console.log('objectives', objectives)\n\n    await creatureService.updateObjectives(user.db_id, creature[0]._id, objectives, user.accessToken)\n      .then(res => console.log('res', res))\n      .catch(err => console.error(err));\n\n    console.log('Successfully updated objectives');\n  }\n\n  // DELETE CREATURE\n  const deleteCreature = async (creatureId) => {\n    const creature = user.creatures.filter(being => being.id === creatureId);\n\n    userDispatch({ type: 'DELETE_CREATURE', id: creatureId });\n\n    await creatureService.deleteCreature(user.db_id, creature[0]._id, user.accessToken)\n      .then(res => res)\n      .catch(err => console.error(err));\n\n    console.log('Successfully deleted creature: ' + creature);\n  }\n\n  const getExp = (habit, time) => { \n    const creature = user.creatures.filter(creature => creature.id === currentId);\n\n    if (creature[0].is_noob) return getFirstExp(creature[0]);\n\n    const streakCount = creature[0].streak_count;\n\n    const newExp = objective.calcExp(creature[0].multiplier, streakCount, habit.difficulty, time);\n    const newTotal = creature[0].exp + newExp;\n\n    const newSurplus = (newTotal >= creature[0].exp_goal) ? \n      newTotal - creature[0].exp_goal :\n      creature[0].exp_surplus + newExp;\n\n    userDispatch({ type: 'ADD_EXP', creature: {\n      id: currentId,\n      newTotal,\n      newSurplus\n    }});\n\n    return creature;\n  }\n\n  const getFirstExp = creature => {\n    const newTotal = 1;\n    const newSurplus = 0;\n\n    userDispatch({ type: 'ADD_EXP', creature: { id: creature.id, newTotal, newSurplus } });\n\n    return creature;\n  }\n\n  const toggleExpUpdate = () => {\n    setExpUpdate(!expUpdate);\n  }\n\n  const toggleFormDisplay = () => {\n    setFormDisplay(!formDisplay);\n  }\n\n  const showCreatureObjectives = async (id) => {\n    return setCurrentId(id);\n  }\n\n  const togglePlay = () => {\n    setPlay(!play);\n  }\n\n  return (\n    <CreatureContext.Provider \n      value={{\n        creatures,\n        createCreature,\n        updateCreatureInfo,\n        updateCreatureStats,\n        updateObjectives,\n        deleteCreature, \n        currentId,\n        play,\n        togglePlay,\n        formDisplay,\n        toggleFormDisplay,\n        expUpdate,\n        toggleExpUpdate,\n        done,\n        setDone,\n        finish,\n        dispatch,\n        showCreatureObjectives,\n        getExp,\n        checkObjectiveText,\n      }}>\n      {props.children}\n    </CreatureContext.Provider>\n  )\n}\n\nexport default CreatureContextProvider;\n"]},"metadata":{},"sourceType":"module"}