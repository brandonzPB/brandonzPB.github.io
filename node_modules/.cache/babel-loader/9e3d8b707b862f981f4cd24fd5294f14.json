{"ast":null,"code":"var _jsxFileName = \"/home/brandonzpb/Documents/projects/custom/creatures-of-habit/front/src/components/creature/Creature.js\";\nimport React, { useState, useEffect, useContext } from 'react';\nimport { CreatureContext } from '../../contexts/CreatureContext';\nimport * as stats from '../../modules/stats';\nimport CreatureDisplay from './CreatureDisplay';\nimport './creature.css';\nimport * as age from '../../modules/age';\n\nconst lvlUpMusicSrc = require('../../sounds/level-up.mp3');\n\nconst levelUpSound = new Audio(lvlUpMusicSrc);\n\nconst evolveMusicSrc = require('../../sounds/evolve.mp3');\n\nconst evolveSound = new Audio(evolveMusicSrc);\n\nconst Creature = ({\n  creature\n}) => {\n  const {\n    displayObjectives,\n    sendCreatureId,\n    expUpdate,\n    toggleExpUpdate,\n    dispatch\n  } = useContext(CreatureContext);\n  const [levelUpdate, setLevelUpdate] = useState(false);\n  const [evolve, setEvolve] = useState(false);\n  const pokeball = !creature.pokeballNumber ? 13 : creature.pokeballNumber < 14 ? 13 // pokeball\n  : creature.pokeballNumber === 14 ? 1 // greatball\n  : creature.pokeballNumber === 15 ? 0 : 11; // ultraball : masterball\n\n  const img = require(`../../images/pokeballs/${pokeball}.png`);\n\n  const toggleLevelUpdate = () => {\n    setLevelUpdate(!levelUpdate);\n  };\n\n  const toggleEvolve = () => {\n    setEvolve(!evolve);\n  }; /// STREAK METHODS ///\n\n\n  const checkCreatureStreak = () => {\n    // checks if streak is broken (true or false)\n    const streakTimestamp = creature.streak.timestamp;\n    const thisTimestamp = new Date().getDay();\n\n    if (streakTimestamp === 6) {\n      // Streak continues if current week day is 0 and less than 24 hours passed\n      if (thisTimestamp !== 0 && thisTimestamp !== 6) {\n        // Streak broken\n        return true;\n      } else {\n        // Same week day, or next week day\n        // if more than 1440 minutes passed; streak is over\n        const minDifference = age.getAge(streakTimestamp, false);\n        return minDifference > 1440 ? true : false;\n      }\n    } else {\n      // Streak continues if current week day is streak.timestamp + 1, and if less than 24 hours passed\n      if (thisTimestamp === streakTimestamp + 1 || thisTimestamp === streakTimestamp) {\n        const minDifference = age.getAge(streakTimestamp, false);\n        return minDifference > 1440 ? true : false;\n      } else {\n        return true;\n      }\n    }\n  };\n\n  const updateCreatureStreak = () => {\n    const newStreak = {\n      count: creature.streak ? creature.streak.count + 1 : 1,\n      timestamp: new Date().getDay()\n    };\n    /* const newDay = (new Date()).getDay();\n     if (creature.streak) {\n      if (creature.streak.timestamp === 6) { // check if current day is 0\n         if (newDay === 0) { // Next day\n          newStreak.count = creature.streak.count + 1;\n          newStreak.timestamp = newDay;\n        }\n      } else { // check if current day is creatures.streak.timestamp +1\n        \n        if (newDay === creature.streak.timestamp + 1) {\n          newStreak.count = creature.streak.count + 1;\n          newStreak.timestamp = newDay;\n        }\n      }\n    } */\n\n    dispatch({\n      type: 'UPDATE_STREAK',\n      creature: {\n        id: creature.id,\n        newStreak\n      }\n    });\n    return creature;\n  };\n\n  const resetCreatureStreak = () => {\n    const newStreak = 0;\n    dispatch({\n      type: 'RESET_STREAK',\n      creature: {\n        id: creature.id,\n        newStreak\n      }\n    });\n    return creature;\n  }; /// AUTO-UPDATE HOOKS ///\n  // Updates age, streak, exp, and level\n\n\n  useEffect(() => {\n    const birthTime = creature.birthTime;\n    const newAge = age.getAge(birthTime);\n    dispatch({\n      type: 'UPDATE_AGE',\n      creature: {\n        newAge,\n        id: creature.id\n      }\n    });\n\n    if (creature.streak) {\n      const isBroken = checkCreatureStreak();\n      if (isBroken) resetCreatureStreak();\n    }\n\n    if (!expUpdate) return;\n    updateCreatureStreak();\n\n    if (creature.exp >= creature.expGoal || creature.isNoob) {\n      levelUpSound.currentTime = 1;\n      levelUpSound.play();\n      const newLevel = creature.level + 1;\n      dispatch({\n        type: 'LEVEL_UP',\n        creature: {\n          id: creature.id,\n          level: newLevel\n        }\n      });\n      return toggleLevelUpdate();\n    }\n\n    toggleExpUpdate();\n  }, [creature.exp]); // Updates creature multipliers\n\n  useEffect(() => {\n    if (!levelUpdate) return;\n    const timer = setTimeout(() => {\n      const difficulty = stats.getCreatureDifficulty(creature.purpose, creature.level);\n      const multiplier = stats.getExpMultiplier(creature.level);\n      dispatch({\n        type: 'UPGRADE_MULTIPLIERS',\n        creature: {\n          id: creature.id,\n          difficulty,\n          multiplier\n        }\n      });\n      const prevGoal = creature.isNoob ? 1 : creature.expGoal;\n      const newGoal = creature.isNoob ? 9 : stats.getExpGoal(creature.level, difficulty);\n      dispatch({\n        type: 'LEVEL_UPDATES',\n        creature: {\n          id: creature.id,\n          prevGoal,\n          newGoal\n        }\n      });\n      toggleExpUpdate();\n      toggleLevelUpdate();\n\n      if (creature.level === 15 || creature.level === 30 || creature.level === 50 || creature.level == 80) {\n        const newPokeball = creature.level === 30 ? 14 : creature.level === 50 ? 15 : creature.level === 80 ? 16 : creature.pokeballNumber;\n        dispatch({\n          type: 'UPDATE_POKEBALL',\n          creature: {\n            id: creature.id,\n            newPokeball\n          }\n        });\n        return toggleEvolve();\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, [levelUpdate]); // Evolves creature\n\n  useEffect(() => {\n    if (!evolve) return;\n    const nextCreatureIndex = creature.evolutionaryLine.findIndex(being => being === creature.creature) + 1;\n    if (!creature.evolutionaryLine[nextCreatureIndex]) return toggleEvolve();\n\n    if (creature.evolutionaryLine[nextCreatureIndex] === 'none') {\n      let newEvoLine = creature.evolutionaryLine;\n      newEvoLine.splice(nextCreatureIndex, 1);\n      console.log('newEvoLine', newEvoLine);\n      return toggleEvolve();\n    }\n\n    setTimeout(() => {\n      evolveSound.play();\n      const nextCreature = creature.evolutionaryLine[nextCreatureIndex];\n      dispatch({\n        type: 'EVOLVE',\n        creature: {\n          id: creature.id,\n          nextCreature\n        }\n      });\n      return toggleEvolve();\n    }, 800);\n  }, [evolve]); // Sends creature id to context and allows for\n  // The selected creature's objectives to be shown\n\n  const displayCreatureActions = () => {\n    sendCreatureId(creature.id);\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"creature\",\n    style: {\n      backgroundImage: `linear-gradient(rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.6)), url(${img})`,\n      backgroundRepeat: 'no-repeat',\n      backgroundSize: 'cover',\n      backgroundPosition: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(CreatureDisplay, {\n    creature: creature,\n    displayObjectives: displayObjectives,\n    displayCreatureActions: displayCreatureActions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default Creature;","map":{"version":3,"sources":["/home/brandonzpb/Documents/projects/custom/creatures-of-habit/front/src/components/creature/Creature.js"],"names":["React","useState","useEffect","useContext","CreatureContext","stats","CreatureDisplay","age","lvlUpMusicSrc","require","levelUpSound","Audio","evolveMusicSrc","evolveSound","Creature","creature","displayObjectives","sendCreatureId","expUpdate","toggleExpUpdate","dispatch","levelUpdate","setLevelUpdate","evolve","setEvolve","pokeball","pokeballNumber","img","toggleLevelUpdate","toggleEvolve","checkCreatureStreak","streakTimestamp","streak","timestamp","thisTimestamp","Date","getDay","minDifference","getAge","updateCreatureStreak","newStreak","count","type","id","resetCreatureStreak","birthTime","newAge","isBroken","exp","expGoal","isNoob","currentTime","play","newLevel","level","timer","setTimeout","difficulty","getCreatureDifficulty","purpose","multiplier","getExpMultiplier","prevGoal","newGoal","getExpGoal","newPokeball","clearTimeout","nextCreatureIndex","evolutionaryLine","findIndex","being","newEvoLine","splice","console","log","nextCreature","displayCreatureActions","backgroundImage","backgroundRepeat","backgroundSize","backgroundPosition"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useContext } from 'react';\nimport { CreatureContext } from '../../contexts/CreatureContext';\nimport * as stats from '../../modules/stats';\nimport CreatureDisplay from './CreatureDisplay';\nimport './creature.css';\nimport * as age from '../../modules/age';\n\nconst lvlUpMusicSrc = require('../../sounds/level-up.mp3');\nconst levelUpSound = new Audio(lvlUpMusicSrc);\n\nconst evolveMusicSrc = require('../../sounds/evolve.mp3');\nconst evolveSound = new Audio(evolveMusicSrc);\n\nconst Creature = ({ creature }) => {\n  const { displayObjectives, sendCreatureId, expUpdate, toggleExpUpdate, dispatch } = useContext(CreatureContext);\n\n  const [levelUpdate, setLevelUpdate] = useState(false);\n  const [evolve, setEvolve] = useState(false);\n\n  const pokeball = (!creature.pokeballNumber) ? 13\n    : (creature.pokeballNumber < 14) ? 13 // pokeball\n    : (creature.pokeballNumber === 14) ? 1 // greatball\n    : (creature.pokeballNumber === 15) ? 0 : 11; // ultraball : masterball\n\n  const img = require(`../../images/pokeballs/${pokeball}.png`);\n\n  const toggleLevelUpdate = () => {\n    setLevelUpdate(!levelUpdate);\n  }\n\n  const toggleEvolve = () => {\n    setEvolve(!evolve);\n  }\n\n  /// STREAK METHODS ///\n\n  const checkCreatureStreak = () => {\n    // checks if streak is broken (true or false)\n    \n    const streakTimestamp = creature.streak.timestamp;\n    const thisTimestamp = (new Date()).getDay();\n\n    if (streakTimestamp === 6) { // Streak continues if current week day is 0 and less than 24 hours passed\n\n      if (thisTimestamp !== 0 && thisTimestamp !== 6) { // Streak broken\n        return true;\n      } else { // Same week day, or next week day\n        // if more than 1440 minutes passed; streak is over\n\n        const minDifference = age.getAge(streakTimestamp, false);\n        return minDifference > 1440 ? true : false;\n      }\n\n    } else { // Streak continues if current week day is streak.timestamp + 1, and if less than 24 hours passed\n      if (thisTimestamp === streakTimestamp + 1 || thisTimestamp === streakTimestamp) {\n        const minDifference = age.getAge(streakTimestamp, false);\n        return minDifference > 1440 ? true : false;\n      } else {\n        return true;\n      }\n    }\n  }\n\n  const updateCreatureStreak = () => {\n    const newStreak = {\n      count: (creature.streak) ? creature.streak.count + 1 : 1,\n      timestamp: (new Date()).getDay()\n    };\n    \n    /* const newDay = (new Date()).getDay();\n\n    if (creature.streak) {\n      if (creature.streak.timestamp === 6) { // check if current day is 0\n\n        if (newDay === 0) { // Next day\n          newStreak.count = creature.streak.count + 1;\n          newStreak.timestamp = newDay;\n        }\n      } else { // check if current day is creatures.streak.timestamp +1\n        \n        if (newDay === creature.streak.timestamp + 1) {\n          newStreak.count = creature.streak.count + 1;\n          newStreak.timestamp = newDay;\n        }\n      }\n    } */\n\n    dispatch({ type: 'UPDATE_STREAK', creature: {\n      id: creature.id,\n      newStreak\n    }});\n\n    return creature;\n  }\n\n  const resetCreatureStreak = () => {\n    const newStreak = 0;\n\n    dispatch({ type: 'RESET_STREAK', creature: {\n      id: creature.id,\n      newStreak\n    }});\n    \n    return creature;\n  }\n\n  /// AUTO-UPDATE HOOKS ///\n\n  // Updates age, streak, exp, and level\n  useEffect(() => { \n    const birthTime = creature.birthTime;\n    const newAge = age.getAge(birthTime);\n\n    dispatch({ type: 'UPDATE_AGE', creature: { newAge, id: creature.id } });\n\n    if (creature.streak) {\n      const isBroken = checkCreatureStreak();\n      if (isBroken) resetCreatureStreak();\n    }\n\n    if (!expUpdate) return;\n    \n    updateCreatureStreak();\n\n    if (creature.exp >= creature.expGoal || creature.isNoob) {\n      levelUpSound.currentTime = 1;\n        levelUpSound.play();\n        \n      const newLevel = creature.level + 1;\n\n      dispatch({ type: 'LEVEL_UP', creature: { id: creature.id, level: newLevel }});\n\n      return toggleLevelUpdate();\n    }\n\n    toggleExpUpdate();\n  }, [creature.exp]);\n\n  // Updates creature multipliers\n  useEffect(() => {\n    if (!levelUpdate) return;\n\n    const timer = setTimeout(() => {\n      const difficulty = stats.getCreatureDifficulty(creature.purpose, creature.level);\n      const multiplier = stats.getExpMultiplier(creature.level);\n\n      dispatch({ type: 'UPGRADE_MULTIPLIERS', creature: { id: creature.id, difficulty, multiplier }});\n\n      const prevGoal = (creature.isNoob) ? 1 : creature.expGoal;\n      const newGoal = (creature.isNoob) ? 9 : stats.getExpGoal(creature.level, difficulty);\n\n      dispatch({ type: 'LEVEL_UPDATES', creature: {\n        id: creature.id,\n        prevGoal,\n        newGoal,\n      }});\n\n      toggleExpUpdate();\n      toggleLevelUpdate();\n\n      if (creature.level === 15 || creature.level === 30 || creature.level === 50 || creature.level == 80) {\n        const newPokeball = (creature.level === 30) ? 14\n          : (creature.level === 50) ? 15 \n          : (creature.level === 80) ? 16 \n          : creature.pokeballNumber;\n\n        dispatch({ type: 'UPDATE_POKEBALL', creature: {\n          id: creature.id,\n          newPokeball\n        }});\n\n        return toggleEvolve();\n      }\n    }, 100);\n\n    return () => clearTimeout(timer);\n  }, [levelUpdate]);\n\n  // Evolves creature\n  useEffect(() => {\n    if (!evolve) return;\n    \n    const nextCreatureIndex = creature.evolutionaryLine.findIndex(being => being === creature.creature) + 1;\n    if (!creature.evolutionaryLine[nextCreatureIndex]) return toggleEvolve();\n\n    if (creature.evolutionaryLine[nextCreatureIndex] === 'none') {\n      let newEvoLine = creature.evolutionaryLine;\n        newEvoLine.splice(nextCreatureIndex, 1);\n      console.log('newEvoLine', newEvoLine);\n\n      return toggleEvolve();\n    }\n\n    setTimeout(() => {\n      evolveSound.play();\n\n      const nextCreature = creature.evolutionaryLine[nextCreatureIndex];\n\n      dispatch({\n        type: 'EVOLVE',\n        creature: {\n          id: creature.id,\n          nextCreature\n        }\n      });\n\n      return toggleEvolve();\n    }, 800);\n  }, [evolve]);\n\n  // Sends creature id to context and allows for\n  // The selected creature's objectives to be shown\n  const displayCreatureActions = () => {\n    sendCreatureId(creature.id);\n  }\n\n  return (\n    <div className=\"creature\" style={{\n      backgroundImage: `linear-gradient(rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.6)), url(${img})`,\n      backgroundRepeat: 'no-repeat',\n      backgroundSize: 'cover',\n      backgroundPosition: 'center',\n    }}>\n      <CreatureDisplay \n        creature={creature}\n        displayObjectives={displayObjectives}\n        displayCreatureActions={displayCreatureActions}\n      />\n    </div>\n  )\n}\n\nexport default Creature;\n"]},"metadata":{},"sourceType":"module"}