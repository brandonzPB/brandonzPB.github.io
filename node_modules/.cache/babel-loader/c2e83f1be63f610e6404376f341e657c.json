{"ast":null,"code":"var _jsxFileName = \"/home/brandonzpb/Documents/projects/custom/creatures-of-habit/creatures-frontend/src/components/user/UserUpdateForm.js\";\nimport React, { useState, useContext } from 'react';\nimport { Link, Route, Redirect } from 'react-router-dom';\nimport { UserContext } from '../../contexts/UserContext';\nimport { CreatureContext } from '../../contexts/CreatureContext';\nimport ConfirmDisplay from '../ConfirmDisplay';\nimport userService from '../../services/userService';\n\nconst UserUpdateForm = () => {\n  const {\n    user,\n    userDispatch,\n    removeUser,\n    checkUsername\n  } = useContext(UserContext);\n  const {\n    finish\n  } = useContext(CreatureContext);\n  const [update, setUpdate] = useState({\n    username: '',\n    email: '',\n    confirmEmail: '',\n    password: '',\n    confirmPassword: ''\n  });\n  const [error, setError] = useState({\n    ref: ''\n  });\n  const [deleteUser, setDeleteUser] = useState({\n    confirmDelete: false,\n    confirmDeletePassword: ''\n  });\n  const [showPassword, setShowPassword] = useState(false);\n\n  if (!user.accessToken) {\n    return /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/user/update\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 31,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Redirect, {\n      to: \"/\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 32,\n        columnNumber: 9\n      }\n    }));\n  }\n\n  const handleChange = event => {\n    const {\n      name,\n      value,\n      className\n    } = event.target;\n\n    if (className === 'delete-user') {\n      return setDeleteUser({ ...deleteUser,\n        confirmDeletePassword: value\n      });\n    }\n\n    setUpdate({ ...update,\n      [name]: value\n    });\n  };\n\n  const handleSubmit = async event => {\n    event.preventDefault();\n    setError({ ...error,\n      ref: ''\n    });\n    let username;\n    let email;\n    let password;\n\n    if (!update.username.trim() && !update.email.trim() && !update.password.trim()) {\n      return false;\n    }\n\n    if (update.username.trim()) {\n      if (update.username !== user.username) {\n        const userExists = await userService.checkUsername('username', update.username, user, user.accessToken).then(res => res);\n\n        if (userExists !== 'Available') {\n          console.log('Username is already taken');\n          return setError({ ...error,\n            ref: 'username'\n          });\n        } else {\n          console.log('Username is available');\n          username = update.username;\n        }\n      } else {\n        username = update.username;\n      }\n    } else {\n      username = user.username;\n    }\n\n    if (update.email.trim()) {\n      if (update.email !== user.email) {\n        const emailExists = await userService.checkUsername('email', update.email, user, user.accessToken).then(res => res);\n\n        if (emailExists !== 'Available') {\n          console.log('Email is already taken');\n          return setError({ ...error,\n            ref: 'email'\n          });\n        } else {\n          console.log('Email is available');\n          email = update.email;\n        }\n      } else {\n        email = update.email;\n      }\n    } else {\n      email = user.email;\n    }\n\n    if (update.password.trim()) {\n      if (update.password !== update.confirmPassword) {\n        return setError({ ...error,\n          ref: 'password'\n        });\n      } else {\n        password = update.password;\n      }\n    } else {\n      password = user.password;\n    }\n\n    if (update.email.trim() !== update.confirmEmail) {\n      return setError({ ...error,\n        ref: 'email'\n      });\n    }\n\n    userDispatch({\n      type: 'UPDATE_USER',\n      user: {\n        username,\n        email,\n        password\n      }\n    });\n    if (password !== user.password) finish('db', null, 'updatePassword');else finish('db', null, 'update');\n    setUpdate({ ...update,\n      username: '',\n      email: '',\n      confirmEmail: '',\n      password: '',\n      confirmPassword: ''\n    });\n  };\n\n  const sendDelete = () => {\n    if (!deleteUser.confirmDelete) {\n      return setDeleteUser({ ...deleteUser,\n        confirmDelete: true,\n        confirmDeletePassword: ''\n      });\n    }\n\n    if (deleteUser.confirmDeletePassword === user.password) {\n      removeUser();\n    }\n  };\n\n  const viewPassword = event => {\n    event.preventDefault();\n    setShowPassword(!showPassword);\n  };\n  /*\n  delete user\n  */\n\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user-info\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Link, {\n    to: \"/creatures\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }\n  }, \"View Creatures\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user-update-form\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"form-title\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 11\n    }\n  }, \"Edit User Info\"), /*#__PURE__*/React.createElement(\"span\", {\n    className: \"user-info-tip\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 11\n    }\n  }, \"Leave it blank if you don't want to change it\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"username-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 13\n    }\n  }, \"New Username: \")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"username-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"text\",\n    name: \"username\",\n    minLength: 2,\n    value: update.username,\n    onChange: handleChange,\n    placeholder: user.username,\n    style: {\n      border: error.ref === 'username' ? '2px solid red' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"email-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 13\n    }\n  }, \"New Email: \")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"email-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    name: \"email\",\n    value: update.email,\n    onChange: handleChange,\n    placeholder: user.email,\n    style: {\n      border: error.ref === 'email' ? '2px solid red' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"email-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, \"Confirm New Email: \")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"confirm-email-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: \"email\",\n    name: \"confirmEmail\",\n    value: update.confirmEmail,\n    onChange: handleChange,\n    style: {\n      border: error.ref === 'email' ? '2px solid red' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"password-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }\n  }, \"New Password: \")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"password-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: showPassword ? 'text' : 'password',\n    name: \"password\",\n    value: update.password,\n    onChange: handleChange,\n    style: {\n      border: error.ref === 'password' ? '2px solid red' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 239,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: viewPassword,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 13\n    }\n  }, \"\\uD83D\\uDC41\")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"password-label\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 13\n    }\n  }, \"Confirm New Password: \")), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"confirm-password-input\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    type: showPassword ? 'text' : 'password',\n    name: \"confirmPassword\",\n    value: update.confirmPassword,\n    onChange: handleChange,\n    style: {\n      border: error.ref === 'password' ? '2px solid red' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: handleSubmit,\n    className: \"submit-form-btn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 11\n    }\n  }, \"Update User\"))), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 7\n    }\n  }, \"Delete User\"), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"confirm-delete\",\n    style: {\n      display: deleteUser.confirmDelete ? 'flex' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 9\n    }\n  }, \"Please enter your password to confirm\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"password\",\n    name: \"confirmDeletePassword\",\n    className: \"delete-user\",\n    value: deleteUser.confirmDeletePassword,\n    onChange: handleChange,\n    style: {\n      border: error.ref === 'delete' ? '2px solid red' : 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 274,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: sendDelete,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 9\n    }\n  }, \"Confirm Delete\")));\n};\n\nexport default UserUpdateForm;","map":{"version":3,"sources":["/home/brandonzpb/Documents/projects/custom/creatures-of-habit/creatures-frontend/src/components/user/UserUpdateForm.js"],"names":["React","useState","useContext","Link","Route","Redirect","UserContext","CreatureContext","ConfirmDisplay","userService","UserUpdateForm","user","userDispatch","removeUser","checkUsername","finish","update","setUpdate","username","email","confirmEmail","password","confirmPassword","error","setError","ref","deleteUser","setDeleteUser","confirmDelete","confirmDeletePassword","showPassword","setShowPassword","accessToken","handleChange","event","name","value","className","target","handleSubmit","preventDefault","trim","userExists","then","res","console","log","emailExists","type","sendDelete","viewPassword","border","display"],"mappings":"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","sourcesContent":["import React, { useState, useContext } from 'react';\nimport { Link, Route, Redirect } from 'react-router-dom';\nimport { UserContext } from '../../contexts/UserContext';\nimport { CreatureContext } from '../../contexts/CreatureContext';\nimport ConfirmDisplay from '../ConfirmDisplay';\nimport userService from '../../services/userService';\n\nconst UserUpdateForm = () => {\n  const { user, userDispatch, removeUser, checkUsername } = useContext(UserContext);\n  const { finish } = useContext(CreatureContext);\n\n  const [update, setUpdate] = useState({\n    username: '',\n    email: '',\n    confirmEmail: '',\n    password: '',\n    confirmPassword: '',\n  });\n\n  const [error, setError] = useState({ ref: '' });\n  \n  const [deleteUser, setDeleteUser] = useState({\n    confirmDelete: false,\n    confirmDeletePassword: '',\n  });\n\n  const [showPassword, setShowPassword] = useState(false);\n\n  if (!user.accessToken) {\n    return (\n      <Route exact path=\"/user/update\">\n        <Redirect to=\"/\" />\n      </Route>\n    )\n  }\n\n  const handleChange = event => {\n    const { name, value, className } = event.target;\n\n    if (className === 'delete-user') {\n      return setDeleteUser({\n        ...deleteUser,\n        confirmDeletePassword: value\n      });\n    }\n\n    setUpdate({\n      ...update,\n      [name]: value\n    });\n  }\n\n  const handleSubmit = async (event) => {\n    event.preventDefault();\n\n    setError({\n      ...error,\n      ref: '',\n    });\n\n    let username;\n    let email;\n    let password;\n\n    if (!update.username.trim() && !update.email.trim() && !update.password.trim()) {\n      return false;\n    }\n\n    if (update.username.trim()) {\n      if (update.username !== user.username) {\n        const userExists = await userService.checkUsername('username', update.username, user, user.accessToken).then(res => res);\n\n        if (userExists !== 'Available') {\n          console.log('Username is already taken');\n\n          return setError({\n            ...error,\n            ref: 'username'\n          });\n        } else {\n          console.log('Username is available');\n          username = update.username;\n        }\n      } else {\n        username = update.username;\n      }\n    } else {\n      username = user.username;\n    }\n\n    if (update.email.trim()) {\n      if (update.email !== user.email) {\n        const emailExists = await userService.checkUsername('email', update.email, user, user.accessToken).then(res => res);\n\n        if (emailExists !== 'Available') {\n          console.log('Email is already taken');\n\n          return setError({\n            ...error,\n            ref: 'email'\n          });\n        } else {\n          console.log('Email is available');\n          email = update.email;\n        }\n      } else {\n        email = update.email;\n      }\n    } else {\n      email = user.email;\n    }\n\n    if (update.password.trim()) {\n      if (update.password !== update.confirmPassword) {\n        return setError({\n          ...error,\n          ref: 'password'\n        });\n      } else {\n        password = update.password;\n      }\n    } else {\n      password = user.password;\n    }\n\n    if (update.email.trim() !== update.confirmEmail) {\n      return setError({\n        ...error,\n        ref: 'email'\n      });\n    }\n\n    userDispatch({ type: 'UPDATE_USER', user: {\n      username, email, password\n    }});\n\n    if (password !== user.password) finish('db', null, 'updatePassword');\n    else finish('db', null, 'update');\n\n    setUpdate({\n      ...update,\n      username: '',\n      email: '',\n      confirmEmail: '',\n      password: '',\n      confirmPassword: '',\n    });\n  }\n\n  const sendDelete = () => {\n    if (!deleteUser.confirmDelete) {\n      return setDeleteUser({\n        ...deleteUser,\n        confirmDelete: true,\n        confirmDeletePassword: '',\n      });\n    }\n\n    if (deleteUser.confirmDeletePassword === user.password) {\n      removeUser();\n    }\n  }\n\n  const viewPassword = (event) => {\n    event.preventDefault();\n\n    setShowPassword(!showPassword);\n  }\n\n  /*\n  delete user\n  */\n\n  return (\n    <div className=\"user-info\">\n      <Link to=\"/creatures\">View Creatures</Link>\n\n      <div className=\"user-update-form\">\n        <form onSubmit={handleSubmit}>\n          <h2 className=\"form-title\">Edit User Info</h2>\n          <span className=\"user-info-tip\">Leave it blank if you don't want to change it</span>\n\n          <div className=\"username-label\">\n            <label>New Username: </label>\n          </div>\n\n          <div className=\"username-input\">\n            <input \n              type=\"text\"\n              name=\"username\"\n              minLength={2}\n              value={update.username}\n              onChange={handleChange}\n              placeholder={user.username}\n              style={{\n                border: error.ref === 'username' ? '2px solid red' : 'none'\n              }}\n            />\n          </div>\n\n          <div className=\"email-label\">\n            <label>New Email: </label>\n          </div>\n\n          <div className=\"email-input\">\n            <input \n              type=\"email\"\n              name=\"email\"\n              value={update.email}\n              onChange={handleChange}\n              placeholder={user.email}\n              style={{\n                border: error.ref === 'email' ? '2px solid red' : 'none'\n              }}\n            />\n          </div>\n\n          <div className=\"email-label\">\n            <label>Confirm New Email: </label>\n          </div>\n\n          <div className=\"confirm-email-input\">\n            <input \n              type=\"email\"\n              name=\"confirmEmail\"\n              value={update.confirmEmail}\n              onChange={handleChange}\n              style={{\n                border: error.ref === 'email' ? '2px solid red' : 'none'\n              }}\n            />\n          </div>\n\n          <div className=\"password-label\">\n            <label>New Password: </label>\n          </div>\n\n          <div className=\"password-input\">\n            <input \n              type={showPassword ? 'text' : 'password'}\n              name=\"password\"\n              value={update.password}\n              onChange={handleChange}\n              style={{\n                border: error.ref === 'password' ? '2px solid red' : 'none'\n              }}\n            />\n            <button onClick={viewPassword}>&#128065;</button>\n          </div>\n\n          <div className=\"password-label\">\n            <label>Confirm New Password: </label>\n          </div>\n\n          <div className=\"confirm-password-input\">\n            <input \n              type={showPassword ? 'text' : 'password'}\n              name=\"confirmPassword\"\n              value={update.confirmPassword}\n              onChange={handleChange}\n              style={{\n                border: error.ref === 'password' ? '2px solid red' : 'none'\n              }}\n            />\n          </div>\n\n          <button onClick={handleSubmit} className=\"submit-form-btn\">Update User</button>\n        </form>\n      </div>\n\n      <button onClick={sendDelete}>Delete User</button>\n      <div className=\"confirm-delete\" style={{ display: deleteUser.confirmDelete ? 'flex' : 'none' }}>\n        <label>Please enter your password to confirm</label>\n        <input \n          type=\"password\"\n          name=\"confirmDeletePassword\"\n          className=\"delete-user\"\n          value={deleteUser.confirmDeletePassword}\n          onChange={handleChange}\n          style={{\n                border: error.ref === 'delete' ? '2px solid red' : 'none'\n          }}\n        />\n        <button onClick={sendDelete}>Confirm Delete</button>\n      </div>\n    </div>\n  )\n}\n\nexport default UserUpdateForm;\n"]},"metadata":{},"sourceType":"module"}